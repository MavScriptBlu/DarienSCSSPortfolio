<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Darien Johnas - Software Developer Portfolio. Showcasing web development projects and skills in React, Node.js, and modern JavaScript."
    />
    <title>Darien Johnas – Web Development Portfolio</title>
    <link rel="stylesheet" href="./dist/main.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
      rel="stylesheet"
    />
  </head>

  <body id="body">
    <header class="header" role="banner">
      <div class="header__container">
        <h1>Darien Johnas</h1>
        <nav class="nav" role="navigation" aria-label="Main navigation">
          <a
            href="#main"
            class="nav__logo nav__skip"
            aria-label="Skip to main content"
          >
            <img
              src="./src/img/DevLogo.gif"
              alt="Darien.dev Logo - Skip to main content"
              class="nav__logo-img"
            />
          </a>
          <button
            class="nav__menu-toggle"
            aria-label="Toggle navigation menu"
            aria-expanded="false"
          >
            <span class="nav__menu-toggle__lines"></span>
          </button>
          <ul class="nav__list">
            <li class="nav__item"><a href="#askmav">Ask Mav</a></li>
            <li class="nav__item">
              <a href="#projects" aria-describedby="projects-section"
                >Projects</a
              >
            </li>
            <li class="nav__item"><a href="#skills">Skills</a></li>
            <li class="nav__item"><a href="#resume">Resume</a></li>
            <li class="nav__item"><a href="#contact">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main id="main" role="main">
      <section id="bio" class="intro-banner" aria-labelledby="intro-heading">
        <div class="intro-content">
          <img
            src="./src/img/profileAvatar.png"
            alt="Professional photo of Darien Johnas, software developer"
            class="slide-in-left"
          />
          <div class="intro-text slide-in-right delay-1">
            <h2 id="intro-heading" class="visually-hidden">
              About Darien Johnas
            </h2>
            <p>
              Passionate software developer with expertise in full-stack web
              development and modern JavaScript frameworks. Currently pursuing
              an Associate in Software Engineering at Mid-State Technical College
              while working as a Software Developer Intern on GenAI projects.
              I build innovative applications with React, Node.js, and AI/ML APIs.
            </p>
            <div class="intro-actions fade-in delay-2">
              <a href="#resume" class="btn" role="button">Resume</a>
              <a href="#skills" class="btn" role="button">Skills</a>
            </div>
          </div>
        </div>
      </section>

      <section id="askmav" class="askmav" aria-labelledby="askmav-heading">
        <h2 id="askmav-heading">Ask Mav</h2>
        <p class="askmav__subtitle">
          Chat with my AI digital twin powered by Llama 3
        </p>

        <div
          class="askmav__container"
          role="region"
          aria-label="Chat interface"
        >
          <div class="askmav__header">
            <span class="askmav__header-title">MavScript AI</span>
            <div class="askmav__header-status">
              <span class="askmav__header-indicator" aria-hidden="true"></span>
              <span>Online</span>
            </div>
          </div>

          <div
            class="askmav__messages"
            id="askmav-messages"
            role="log"
            aria-live="polite"
            aria-label="Chat messages"
          >
            <div class="askmav__message askmav__message--assistant">
              Hey! I'm Mav, Darien's AI assistant. Ask me about her projects,
              skills, or journey from fabrication to full-stack development!
            </div>
          </div>

          <form class="askmav__input-area" id="askmav-form">
            <label for="askmav-input" class="visually-hidden"
              >Type your message</label
            >
            <input
              type="text"
              id="askmav-input"
              class="askmav__input"
              placeholder="Ask me anything about Darien..."
              autocomplete="off"
              aria-describedby="askmav-hint"
            />
            <span id="askmav-hint" class="visually-hidden">
              Press Enter or click Send to submit your question
            </span>
            <button
              type="submit"
              class="askmav__send"
              aria-label="Send message"
            >
              Send
            </button>
          </form>
        </div>
      </section>

      <section
        id="projects"
        class="projects"
        aria-labelledby="projects-heading"
      >
        <h2 id="projects-heading">Latest Projects</h2>
        <div class="project-cards">
          <!-- PixelBoof - Featured -->
          <article class="card card--featured">
            <img
              src="./src/img/pixelboof-sticker.png"
              alt="PixelBoof GenAI Photo Booth - 90s pixel art sticker generated from a photo"
            />
            <h3>PixelBoof</h3>
            <p>
              GenAI-powered photo booth experience that transforms portraits
              using cutting-edge AI models. Built for Mid-State Tech-Con 2.0,
              producing 100+ physical stickers for event attendees.
            </p>
            <div class="card__tags">
              <span class="card__tag">GenAI</span>
              <span class="card__tag">React</span>
              <span class="card__tag">Cloudflare Workers</span>
              <span class="card__tag">AI/ML</span>
            </div>
            <div class="card__links">
              <a
                href="https://pixelbooth-784690008259.us-central1.run.app/"
                class="card__link card__link--primary"
                target="_blank"
                rel="noopener noreferrer"
              >
                View Project
              </a>
              <a
                href="https://github.com/MavScriptBlu/PixelBoof"
                class="card__link card__link--secondary"
                target="_blank"
                rel="noopener noreferrer"
              >
                GitHub
              </a>
            </div>
          </article>

          <!-- MavScript Universe -->
          <article class="card">
            <img
              src="./src/img/mavscript-universe.png"
              alt="MavScript Universe - 9-card legendary collection featuring coding companions"
            />
            <h3>MavScript Universe</h3>
            <p>
              Interactive 3D trading card collection with CSS physics-powered
              holographic effects. A digital retrospective of my journey styled
              as a legendary card game.
            </p>
            <div class="card__tags">
              <span class="card__tag">React 18</span>
              <span class="card__tag">3D CSS</span>
              <span class="card__tag">Vite</span>
              <span class="card__tag">SCSS</span>
            </div>
            <div class="card__links">
              <a
                href="https://mavscriptblu.github.io/trading-cards-react/"
                class="card__link card__link--primary"
                target="_blank"
                rel="noopener noreferrer"
              >
                View Cards
              </a>
              <a
                href="https://github.com/MavScriptBlu/trading-cards-react"
                class="card__link card__link--secondary"
                target="_blank"
                rel="noopener noreferrer"
              >
                GitHub
              </a>
            </div>
          </article>

          <!-- MavScript Con Scheduler -->
          <article class="card">
            <img
              src="./src/img/con-scheduler.png"
              alt="MavScript Con Scheduler - Convention event planning and scheduling application"
            />
            <h3>MavScript Con Scheduler</h3>
            <p>
              Convention event scheduling app for organizing panels, workshops,
              and meetups. Features intuitive drag-and-drop scheduling, session
              management, and responsive design for on-the-go planning.
            </p>
            <div class="card__tags">
              <span class="card__tag">JavaScript</span>
              <span class="card__tag">HTML/CSS</span>
              <span class="card__tag">Event Planning</span>
              <span class="card__tag">Responsive</span>
            </div>
            <div class="card__links">
              <a
                href="https://mavscriptblu.github.io/MavScript-con-scheduler/"
                class="card__link card__link--primary"
                target="_blank"
                rel="noopener noreferrer"
              >
                Live Demo
              </a>
              <a
                href="https://github.com/MavScriptBlu/MavScript-con-scheduler"
                class="card__link card__link--secondary"
                target="_blank"
                rel="noopener noreferrer"
              >
                GitHub
              </a>
            </div>
          </article>
        </div>
        <a
          href="https://github.com/MavScriptBlu"
          class="btn"
          role="button"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="View all projects on GitHub"
          >View All Projects</a
        >
      </section>

      <section id="skills" class="skills" aria-labelledby="skills-heading">
        <h2 id="skills-heading">Skills & Technologies</h2>
        <div class="skills-grid">
          <div class="skill-category">
            <h3>Frontend</h3>
            <ul>
              <li>HTML5 & CSS3</li>
              <li>JavaScript (ES6+)</li>
              <li>React & Next.js</li>
              <li>SCSS/Sass</li>
              <li>3D CSS / WebGL</li>
              <li>Responsive Design</li>
            </ul>
          </div>
          <div class="skill-category">
            <h3>Backend & Data</h3>
            <ul>
              <li>Node.js & Express</li>
              <li>MongoDB</li>
              <li>Snowflake (GenAI Certified)</li>
              <li>REST APIs</li>
              <li>Cloudflare Workers</li>
              <li>Authentication</li>
            </ul>
          </div>
          <div class="skill-category">
            <h3>AI & GenAI</h3>
            <ul>
              <li>Llama 3 / LLM Integration</li>
              <li>Prompt Engineering</li>
              <li>AI-Powered Applications</li>
              <li>Cloudflare AI</li>
              <li>Image Generation APIs</li>
            </ul>
          </div>
          <div class="skill-category">
            <h3>Tools & Methods</h3>
            <ul>
              <li>Git & GitHub</li>
              <li>Webpack & Vite</li>
              <li>Figma & Design Tools</li>
              <li>Agile / Scrum</li>
              <li>Technical Documentation</li>
            </ul>
          </div>
          <div class="skill-category">
            <h3>Certifications</h3>
            <ul>
              <li>TripleTen Software Engineering</li>
              <li>Snowflake GenAI</li>
              <li>MongoDB Basics</li>
              <li>Udacity Frontend NanoDegree</li>
              <li>SQL Fundamentals</li>
            </ul>
          </div>
          <div class="skill-category">
            <h3>Unique Background</h3>
            <ul>
              <li>Production Optimization</li>
              <li>Process Automation</li>
              <li>Quality Control Systems</li>
              <li>Cross-functional Training</li>
              <li>Problem-solving from Fabrication</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="resume" class="resume" aria-labelledby="resume-heading">
        <h2 id="resume-heading">Resume</h2>
        <div class="resume-content">
          <div class="resume-section">
            <h3>Education</h3>
            <div class="resume-item">
              <h4>Mid-State Technical College</h4>
              <p class="duration">Jan 2026 – Present (2nd Semester)</p>
              <p>
                Associate in Software Engineering — Building on full-stack
                foundations with coursework in data structures, algorithms, and
                software architecture. Leading the PixelBoof GenAI lab project
                combining AI/ML with physical-digital automation.
              </p>
            </div>
            <div class="resume-item">
              <h4>TripleTen Software Engineering</h4>
              <p class="duration">Sep 2024 – Sep 2025 (Completed)</p>
              <p>
                Full-Stack Web Development — Built responsive web apps using
                React, Node.js, and MongoDB with a focus on accessibility and
                performance. Integrated RESTful APIs and completed certifications
                in Front-End Engineering, SQL, and HTML/CSS.
              </p>
            </div>
            <div class="resume-item">
              <h4>Udacity / OneTen Scholarship</h4>
              <p class="duration">May 2025 – Sep 2025 (Completed)</p>
              <p>Frontend Web Development Fundamentals — NanoDegree</p>
            </div>
          </div>
          <div class="resume-section">
            <h3>Experience</h3>
            <div class="resume-item">
              <h4>Software Developer Intern</h4>
              <p class="duration">Jan 2026 – Present</p>
              <p class="company">Mid-State Technical College, Wisconsin Rapids, WI</p>
              <p>
                Leading the PixelBoof GenAI lab project — building AI-powered
                photo booth experiences that combine cutting-edge generative AI
                with physical-digital automation. Developing full-stack solutions
                using React, Cloudflare Workers, and AI/ML APIs.
              </p>
            </div>
            <div class="resume-item">
              <h4>Fabrication & Production Lead</h4>
              <p class="duration">2020 – 2024</p>
              <p class="company">
                Piper Products / Crystal Finishing / Gordon Aluminum, WI
              </p>
              <p>
                Led process optimization and quality control initiatives across
                production environments. Created real-time monitoring systems
                and training documentation — skills directly transferable to
                frontend dashboards, API development, and technical documentation.
              </p>
            </div>
          </div>
          <a
            href="./src/assets/Darien_Maverick_Resume_2026.pdf"
            class="btn download-btn"
            aria-label="View resume PDF in new window"
            target="_blank"
            rel="noopener noreferrer"
            >View Resume PDF</a
          >
        </div>
      </section>

      <section id="contact" class="contact" aria-labelledby="contact-heading">
        <h2 id="contact-heading">Get In Touch</h2>
        <div class="contact-content">
          <p>
            I'm always interested in new opportunities and collaborations. Let's
            connect!
          </p>
          <div class="contact-links">
            <a
              href="mailto:darien.johnas@example.com"
              class="contact-link"
              aria-label="Send email to Darien"
            >
              <span>Email</span>
            </a>
            <a
              href="https://www.linkedin.com/in/darien-blue"
              class="contact-link"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Visit Darien's LinkedIn profile"
            >
              <span>LinkedIn</span>
            </a>
            <a
              href="https://github.com/MavScriptBlu"
              class="contact-link"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Visit Darien's GitHub profile"
            >
              <span>GitHub</span>
            </a>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer" role="contentinfo">
      <p>&copy; Darien Johnas 2025</p>
    </footer>

    <script>
      // Mobile menu toggle
      const menuToggle = document.querySelector('.nav__menu-toggle');
      const navList = document.querySelector('.nav__list');

      if (menuToggle && navList) {
        // Click handler for mobile menu toggle
        menuToggle.addEventListener('click', function () {
          const isOpen = navList.classList.contains('open');
          navList.classList.toggle('open');
          menuToggle.setAttribute('aria-expanded', !isOpen);
        });

        // Keyboard handler for mobile menu toggle
        menuToggle.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const isOpen = navList.classList.contains('open');
            navList.classList.toggle('open');
            menuToggle.setAttribute('aria-expanded', !isOpen);
          }
        });

        // Close menu when clicking on a link
        const navLinks = document.querySelectorAll('.nav__item a');
        navLinks.forEach(link => {
          link.addEventListener('click', () => {
            navList.classList.remove('open');
            menuToggle.setAttribute('aria-expanded', false);
          });
        });

        // Close menu when clicking outside of it
        document.addEventListener('click', function (e) {
          // Check if menu is open and click is outside nav area
          if (navList.classList.contains('open')) {
            const nav = document.querySelector('.nav');

            // If click is outside the nav element, close the menu
            if (!nav.contains(e.target)) {
              navList.classList.remove('open');
              menuToggle.setAttribute('aria-expanded', false);
            }
          }
        });
      }

      // Enhanced keyboard navigation for all interactive elements
      document.addEventListener('keydown', function (e) {
        // Handle Escape key to close mobile menu
        if (
          e.key === 'Escape' &&
          navList &&
          navList.classList.contains('open')
        ) {
          navList.classList.remove('open');
          menuToggle.setAttribute('aria-expanded', false);
          menuToggle.focus(); // Return focus to toggle button
        }

        // Handle Enter and Space for elements with role="button"
        if (
          (e.key === 'Enter' || e.key === ' ') &&
          e.target.getAttribute('role') === 'button'
        ) {
          e.preventDefault();
          e.target.click();
        }

        // Handle Tab key to ensure no keyboard traps
        if (e.key === 'Tab') {
          // Check if we're tabbing within a modal or overlay
          const activeElement = document.activeElement;
          const focusableElements = document.querySelectorAll(
            'a[href], button, input, select, textarea, [tabindex]:not([tabindex="-1"]), [role="button"]'
          );

          // Ensure tab navigation stays within visible elements
          const visibleFocusableElements = Array.from(focusableElements).filter(
            el => {
              return el.offsetParent !== null && !el.hasAttribute('disabled');
            }
          );

          if (visibleFocusableElements.length === 0) return;

          const firstElement = visibleFocusableElements[0];
          const lastElement =
            visibleFocusableElements[visibleFocusableElements.length - 1];

          // If mobile menu is open, trap focus within navigation
          if (navList && navList.classList.contains('open')) {
            const navFocusableElements = navList.querySelectorAll('a[href]');
            const firstNavElement = navFocusableElements[0];
            const lastNavElement =
              navFocusableElements[navFocusableElements.length - 1];

            if (e.shiftKey) {
              // Shift + Tab
              if (
                activeElement === firstNavElement ||
                activeElement === menuToggle
              ) {
                e.preventDefault();
                lastNavElement.focus();
              }
            } else {
              // Tab
              if (activeElement === lastNavElement) {
                e.preventDefault();
                menuToggle.focus();
              }
            }
          }
        }
      });

      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start',
            });

            // Move focus to target for keyboard users if it's focusable
            if (
              target.hasAttribute('tabindex') ||
              target.matches('input, button, select, textarea, a[href]')
            ) {
              setTimeout(() => target.focus(), 100);
            }
          }
        });

        // Handle keyboard activation for anchor links
        anchor.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            this.click();
          }
        });
      });

      // Header shrinking on scroll
      let lastScrollY = window.scrollY;
      const header = document.querySelector('.header');

      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          header.classList.add('shrunk');
        } else {
          header.classList.remove('shrunk');
        }
        lastScrollY = window.scrollY;
      });

      // Modern page lifecycle management using pagehide/pageshow
      // This is more reliable than the deprecated 'unload' event

      // Generate unique session ID for analytics
      const sessionId =
        'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      const pageLoadTime = Date.now();

      function savePortfolioState() {
        // Save any portfolio state to localStorage
        const portfolioState = {
          scrollPosition: window.scrollY,
          activeSection:
            document.querySelector('section:target')?.id || getCurrentSection(),
          timestamp: Date.now(),
          sessionId: sessionId,
        };
        localStorage.setItem('portfolioState', JSON.stringify(portfolioState));
      }

      function getCurrentSection() {
        // Determine current section based on scroll position
        const sections = document.querySelectorAll('section, main > div');
        let currentSection = 'intro';

        sections.forEach(section => {
          const rect = section.getBoundingClientRect();
          if (rect.top <= 200 && rect.bottom > 200) {
            currentSection =
              section.id || section.className.split(' ')[0] || 'intro';
          }
        });

        return currentSection;
      }

      function restorePortfolioState() {
        try {
          const savedState = localStorage.getItem('portfolioState');
          if (savedState) {
            const state = JSON.parse(savedState);
            // Only restore if saved recently (within 30 minutes)
            if (Date.now() - state.timestamp < 1800000) {
              // Restore scroll position with smooth behavior
              setTimeout(() => {
                window.scrollTo({
                  top: state.scrollPosition,
                  behavior: 'smooth',
                });
              }, 100);
            }
          }
        } catch (error) {
          console.warn('Failed to restore portfolio state:', error);
        }
      }

      // Beacon API for reliable logging and analytics
      function sendAnalyticsBeacon(eventType, data = {}) {
        const analyticsData = {
          sessionId: sessionId,
          timestamp: Date.now(),
          eventType: eventType,
          url: window.location.href,
          userAgent: navigator.userAgent,
          viewport: {
            width: window.innerWidth,
            height: window.innerHeight,
          },
          ...data,
        };

        // Use Beacon API for reliable delivery even during page unload
        if (navigator.sendBeacon) {
          // In a real app, this would go to your analytics endpoint
          const blob = new Blob([JSON.stringify(analyticsData)], {
            type: 'application/json',
          });

          // For demo purposes, we'll use a placeholder endpoint
          // Replace with your actual logging endpoint
          console.log('Analytics beacon:', analyticsData);

          // Example of actual beacon usage:
          // navigator.sendBeacon('/api/analytics', blob);
        } else {
          // Fallback for older browsers
          fetch('/api/analytics', {
            method: 'POST',
            body: JSON.stringify(analyticsData),
            headers: { 'Content-Type': 'application/json' },
            keepalive: true,
          }).catch(error => console.warn('Analytics fallback failed:', error));
        }
      }

      // Track page engagement and interactions
      let engagementData = {
        scrollDepth: 0,
        timeOnPage: 0,
        interactionCount: 0,
        sectionsVisited: new Set(),
      };

      // Use pagehide instead of deprecated unload event
      window.addEventListener('pagehide', event => {
        // Calculate final engagement metrics
        const finalEngagement = {
          ...engagementData,
          timeOnPage: Date.now() - pageLoadTime,
          scrollDepth: Math.max(
            engagementData.scrollDepth,
            (window.scrollY /
              (document.body.scrollHeight - window.innerHeight)) *
              100
          ),
          sectionsVisited: Array.from(engagementData.sectionsVisited),
          exitType: event.persisted ? 'bfcache' : 'unload',
        };

        // Send analytics beacon (non-blocking)
        sendAnalyticsBeacon('page_exit', finalEngagement);

        if (!event.persisted) {
          // Page is being unloaded (not going to BFCache)
          savePortfolioState();
        }
      });

      // Restore state when page is shown (including from BFCache)
      window.addEventListener('pageshow', event => {
        if (event.persisted) {
          // Page was restored from BFCache
          restorePortfolioState();
          sendAnalyticsBeacon('page_restore_bfcache');
        } else {
          // Fresh page load
          sendAnalyticsBeacon('page_load');
        }
      });

      // Track visibility changes (tab switches, minimizing)
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'hidden') {
          // Lightweight save when tab becomes hidden
          savePortfolioState();
          sendAnalyticsBeacon('tab_hidden', {
            timeVisible: Date.now() - pageLoadTime,
            currentSection: getCurrentSection(),
          });
        } else if (document.visibilityState === 'visible') {
          sendAnalyticsBeacon('tab_visible');
        }
      });

      // Enhanced scroll tracking with debouncing
      let saveStateTimeout;
      let scrollAnalyticsTimeout;

      window.addEventListener(
        'scroll',
        () => {
          // Update engagement data
          const scrollPercent =
            (window.scrollY /
              (document.body.scrollHeight - window.innerHeight)) *
            100;
          engagementData.scrollDepth = Math.max(
            engagementData.scrollDepth,
            scrollPercent
          );
          engagementData.sectionsVisited.add(getCurrentSection());

          // Debounced state saving
          clearTimeout(saveStateTimeout);
          saveStateTimeout = setTimeout(savePortfolioState, 500);

          // Debounced analytics (less frequent than state saving)
          clearTimeout(scrollAnalyticsTimeout);
          scrollAnalyticsTimeout = setTimeout(() => {
            sendAnalyticsBeacon('scroll_milestone', {
              scrollDepth: Math.round(scrollPercent),
              currentSection: getCurrentSection(),
            });
          }, 2000);
        },
        { passive: true }
      );

      // Track user interactions
      document.addEventListener('click', event => {
        engagementData.interactionCount++;

        const target = event.target.closest('a, button, .nav__item');
        if (target) {
          sendAnalyticsBeacon('interaction', {
            elementType: target.tagName.toLowerCase(),
            elementText: target.textContent?.trim().substring(0, 50),
            elementClass: target.className,
            currentSection: getCurrentSection(),
          });
        }
      });

      // Performance monitoring
      window.addEventListener('load', () => {
        // Send performance metrics
        if (performance.getEntriesByType) {
          const perfData = performance.getEntriesByType('navigation')[0];
          if (perfData) {
            sendAnalyticsBeacon('performance', {
              loadTime: perfData.loadEventEnd - perfData.fetchStart,
              domContentLoaded:
                perfData.domContentLoadedEventEnd - perfData.fetchStart,
              firstPaint:
                performance
                  .getEntriesByType('paint')
                  .find(entry => entry.name === 'first-paint')?.startTime || 0,
            });
          }
        }
      });

      // ============================================
      // AskMav Chat Functionality
      // ============================================
      const ASKMAV_API_URL = 'YOUR_CLOUDFLARE_WORKER_URL'; // Replace with your Worker URL

      class AskMavChat {
        constructor() {
          this.form = document.getElementById('askmav-form');
          this.input = document.getElementById('askmav-input');
          this.messages = document.getElementById('askmav-messages');
          this.sendButton = this.form?.querySelector('.askmav__send');

          if (this.form) {
            this.init();
          }
        }

        init() {
          this.form.addEventListener('submit', e => this.handleSubmit(e));
          this.input.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              this.form.dispatchEvent(new Event('submit'));
            }
          });
        }

        async handleSubmit(e) {
          e.preventDefault();
          const message = this.input.value.trim();
          if (!message) return;

          // Add user message
          this.addMessage(message, 'user');
          this.input.value = '';
          this.setLoading(true);

          // Show typing indicator
          const typingIndicator = this.addTypingIndicator();

          try {
            const response = await this.sendMessage(message);
            typingIndicator.remove();
            this.addMessage(response, 'assistant');
          } catch (error) {
            typingIndicator.remove();
            this.addMessage(
              "Sorry, I'm having trouble connecting right now. Please try again later or reach out via the contact section!",
              'assistant'
            );
            console.error('AskMav error:', error);
          } finally {
            this.setLoading(false);
            this.input.focus();
          }
        }

        async sendMessage(message) {
          const response = await fetch(ASKMAV_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          return data.response || data.message || 'I received your message!';
        }

        addMessage(text, sender) {
          const messageEl = document.createElement('div');
          messageEl.className = `askmav__message askmav__message--${sender}`;
          messageEl.textContent = text;
          this.messages.appendChild(messageEl);
          this.scrollToBottom();
          return messageEl;
        }

        addTypingIndicator() {
          const indicator = document.createElement('div');
          indicator.className =
            'askmav__message askmav__message--assistant askmav__message--typing';
          indicator.setAttribute('aria-label', 'Mav is typing');
          indicator.innerHTML = '<span></span><span></span><span></span>';
          this.messages.appendChild(indicator);
          this.scrollToBottom();
          return indicator;
        }

        scrollToBottom() {
          this.messages.scrollTop = this.messages.scrollHeight;
        }

        setLoading(loading) {
          this.sendButton.disabled = loading;
          this.input.disabled = loading;
        }
      }

      // Initialize AskMav chat
      new AskMavChat();

      // ============================================
      // 3D Card Holographic Effect
      // ============================================
      function initCard3DEffects() {
        const cards = document.querySelectorAll('.card');

        cards.forEach(card => {
          card.addEventListener('mousemove', e => {
            // Respect reduced motion preference
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
              return;
            }

            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateX = (y - centerY) / 20;
            const rotateY = (centerX - x) / 20;

            // Update CSS custom properties for glow position
            const mouseXPercent = (x / rect.width) * 100;
            const mouseYPercent = (y / rect.height) * 100;
            card.style.setProperty('--mouse-x', `${mouseXPercent}%`);
            card.style.setProperty('--mouse-y', `${mouseYPercent}%`);

            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
          });

          card.addEventListener('mouseleave', () => {
            card.style.transform =
              'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
          });
        });
      }

      // Initialize 3D card effects
      initCard3DEffects();
    </script>
  </body>
</html>
